#!/usr/bin/env python3

import os
import argparse
import gobjcreator3
from gobjcreator3.compiler import Compiler
from gobjcreator3.codegen.output import FileOut
from gobjcreator3.codegen.c_code_generator import CCodeGenerator, CGenConfig

parser = argparse.ArgumentParser()
parser.add_argument(
				"goc_file", 
				help="GObjectCreator input file"
				)
parser.add_argument(
				"--version",
				action="version",
				version=gobjcreator3.VERSION
				)
parser.add_argument(
				"--header-comment-file",
				dest="header_comment_file",
				default="",
				metavar="FILE",
				help="generate header comment from content of file FILE"
				)
parser.add_argument(
				"--enable-base-functions",
				action="store_true",
				dest="enable_base_functions",
				help="generate base init and base finalize functions"
				)
parser.add_argument(
				"--enable-constructor",
				action="store_true",
				dest="enable_constructor",
				help="generate constructor function"
				)
parser.add_argument(
				"--enable-setter-getter",
				action="store_true",
				dest="enable_setter_getter",
				help="generate setters and getters for properties"
				)
parser.add_argument(
				"-v", "--verbose",
				action="store_true",
				help="verbose generation output"
				)
parser.add_argument("-d", "--dir",
				default=os.curdir,
				help="directory where files will be generated in"
				) 

args = parser.parse_args()

# Compile and generate code:

model = Compiler().compile(args.goc_file)
config = CGenConfig()
config.generate_base_functions = args.enable_base_functions
config.generate_constructor = args.enable_constructor
config.generate_setter_getter = args.enable_setter_getter
config.verbose = args.verbose
config.header_text_file = args.header_comment_file

generator = CCodeGenerator(model, args.goc_file, FileOut(args.dir), config) 

generator.generate()

exit(0)